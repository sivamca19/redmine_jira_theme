<% s = Setting.plugin_redmine_jira_theme %>
<p>
  <label for="settings_enabled"><%= l('jira_theme.label_enabled') %></label>
  <%= check_box_tag 'settings[enabled]', '1', s['enabled'] == '1' %>
</p>
<p>
  <label>Default theme mode</label>
  <%= select_tag 'settings[mode]',
        options_for_select([['System', 'system'], ['Light', 'light'], ['Dark', 'dark']], s['mode']) %>
</p>
<p>
  <label>Allow users to toggle theme</label>
  <%= hidden_field_tag 'settings[allow_user_toggle]', '0' %>
  <%= check_box_tag 'settings[allow_user_toggle]', '1', s['allow_user_toggle'] == '1' %>
</p>
<p>
  <label>Remember sidebar state</label>
  <%= hidden_field_tag 'settings[remember_sidebar]', '0' %>
  <%= check_box_tag 'settings[remember_sidebar]', '1', s['remember_sidebar'] == '1' %>
</p>

<fieldset class="box collapsible collapsed">
  <legend onclick="toggleFieldset(this);" class='icon icon-collapsed'>
    <svg class="s18 icon-svg" aria-hidden="true"><use href="/assets/icons-731dc012.svg#icon--angle-right"></use></svg>
    Tracker Colors
  </legend>
  <% tracker_colors = Setting.plugin_redmine_jira_theme['tracker_colors'] || {} %>
  <div class="tabular settings">
    <% Tracker.all.order(:position).each do |tracker| %>
      <% color = tracker_colors[tracker.name.downcase].presence || "##{SecureRandom.hex(3)}" %>
      <p class="color-wrapper">
        <label for="settings_tracker_colors_<%= tracker.id %>"><%= tracker.name %></label>
        <input type="color"
          name="settings[tracker_colors][<%= tracker.name.downcase %>]"
          id="settings_tracker_colors_<%= tracker.id %>"
          value="<%= color %>">
      </p>
    <% end %>
  </div>
</fieldset>

<fieldset class="box collapsible collapsed">
  <legend onclick="toggleFieldset(this);" class='icon icon-collapsed'>
    <svg class="s18 icon-svg" aria-hidden="true"><use href="/assets/icons-731dc012.svg#icon--angle-right"></use></svg>
    Status Colors
  </legend>
  <% status_colors = Setting.plugin_redmine_jira_theme['status_colors'] || {} %>
  <div class="tabular settings">
    <% IssueStatus.all.order(:position).each do |status| %>
      <% color = status_colors[status.name.downcase].presence || "##{SecureRandom.hex(3)}" %>
      <p class="color-wrapper">
        <label for="settings_status_colors_<%= status.id %>"><%= status.name %></label>
        <input type="color"
          name="settings[status_colors][<%= status.name.downcase %>]"
          id="settings_status_colors_<%= status.id %>"
          value="<%= color %>">
      </p>
    <% end %>
  </div>
</fieldset>

<fieldset class="box collapsible collapsed">
  <legend onclick="toggleFieldset(this);" class='icon icon-collapsed'>
    <svg class="s18 icon-svg" aria-hidden="true"><use href="/assets/icons-731dc012.svg#icon--angle-right"></use></svg>
    Priority Colors
  </legend>
  <% priority_colors = Setting.plugin_redmine_jira_theme['priority_colors'] || {} %>
  <div class="tabular settings">
    <% IssuePriority.all.order(:position).each do |priority| %>
      <% color = priority_colors[priority.name.downcase].presence || "##{SecureRandom.hex(3)}" %>
      <p class="color-wrapper">
        <label for="settings_priority_colors_<%= priority.id %>"><%= priority.name %></label>
        <input type="color"
          name="settings[priority_colors][<%= priority.name.downcase %>]"
          id="settings_priority_colors_<%= priority.id %>"
          value="<%= color %>">
      </p>
    <% end %>
  </div>
</fieldset>

<fieldset class="jira-theme-plugin-setting-upload collapsible collapsed">
  <legend onclick="toggleFieldset(this);" class='icon icon-collapsed'>
    <svg class="s18 icon-svg" aria-hidden="true"><use href="/assets/icons-731dc012.svg#icon--angle-right"></use></svg>
    Logo Settings
  </legend>
  <div class="splitcontent">
    <div class="splitcontentright section-wrp">
      <p><label>Light Theme Logo</label></p>
    </div>
    <div class="splitcontentleft section-wrp">
      <div class="box tabular">
        <% if s['logo_light'].present? %>
          <div class="image-upload-section">
            <%= image_tag(s['logo_light'], class: 'light', alt: 'Light Logo Preview') %>
            <div>
              <%= link_to 'Remove', '#',
                  onclick: "if(confirm('Remove light logo?')) {
                    document.getElementById('remove_logo_light').value = '1';
                    this.parentElement.parentElement.style.display = 'none';
                  } return false;",
                  class:'remove'%>
            </div>
          </div>
        <% end %>
        <%= file_field_tag 'logo_light', accept: 'image/*' %>
        <%= hidden_field_tag 'settings[remove_logo_light]', '0', id: 'remove_logo_light' %>
        <div class="jira-recommend-section">
          Recommended: PNG format, max 200x50px for best results
        </div>
      </div>
    </div>
  </div>
  <div class="splitcontent">
    <div class="splitcontentright section-wrp">
      <p>
        <label>Dark Theme Logo</label>
      </p>
    </div>
    <div class="splitcontentleft section-wrp">
      <div class="box tabular">
        <% if s['logo_dark'].present? %>
          <div class="image-upload-section dark">
            <%= image_tag(s['logo_dark'], class: 'dark', alt: 'Dark Logo Preview') %>
            <div>
              <%= link_to 'Remove', '#',
                  onclick: "if(confirm('Remove dark logo?')) {
                    document.getElementById('remove_logo_dark').value = '1';
                    this.parentElement.parentElement.style.display = 'none';
                  } return false;",
                  class:'remove' %>
            </div>
          </div>
        <% end %>
        <%= file_field_tag 'logo_dark', accept: 'image/*' %>
        <%= hidden_field_tag 'settings[remove_logo_dark]', '0', id: 'remove_logo_dark' %>
        <div class="jira-recommend-section">
          Recommended: PNG format, max 200x50px for best results
        </div>
      </div>
    </div>
  </div>

  <div class="jira-note-section ">
    <strong>Note:</strong> If custom logos are not uploaded, the plugin will use the default logo-white.png and logo-black.png from the plugin assets.
  </div>
</fieldset>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form[action*="/settings/plugin/redmine_jira_theme"]');
    if (form) {
      form.addEventListener('submit', function() {
        form.setAttribute('enctype', 'multipart/form-data');
      });
    }
  });
</script>