<% s = Setting.plugin_redmine_jira_theme %>
<p>
  <label for="settings_enabled"><%= l('jira_theme.label_enabled') %></label>
  <%= check_box_tag 'settings[enabled]', '1', s['enabled'] == '1' %>
</p>
<p>
  <label>Default theme mode</label>
  <%= select_tag 'settings[mode]',
        options_for_select([['System', 'system'], ['Light', 'light'], ['Dark', 'dark']], s['mode']) %>
</p>
<p>
  <label>Allow users to toggle theme</label>
  <%= hidden_field_tag 'settings[allow_user_toggle]', '0' %>
  <%= check_box_tag 'settings[allow_user_toggle]', '1', s['allow_user_toggle'] == '1' %>
</p>
<p>
  <label>Remember sidebar state</label>
  <%= hidden_field_tag 'settings[remember_sidebar]', '0' %>
  <%= check_box_tag 'settings[remember_sidebar]', '1', s['remember_sidebar'] == '1' %>
</p>

<fieldset class="box collapsible collapsed">
  <legend onclick="toggleFieldset(this);" class='icon icon-collapsed'>
    <svg class="s18 icon-svg" aria-hidden="true"><use href="/assets/icons-731dc012.svg#icon--angle-right"></use></svg>
    Theme Colors
  </legend>
  <div class="tabular settings">
    <p>
      <label>Reset to JIRA defaults</label>
      <%= button_tag 'Reset Theme Colors', type: 'button',
          onclick: "if(confirm('This will reset all theme colors to JIRA defaults. Continue?')) { resetThemeColors(); }",
          class: 'button-small' %>
      <em>Reset all theme colors to the latest JIRA design system defaults</em>
    </p>
    <p>
      <label>Auto-generate dark theme from light colors</label>
      <%= hidden_field_tag 'settings[auto_generate_dark]', '0' %>
      <%= check_box_tag 'settings[auto_generate_dark]', '1', s['auto_generate_dark'] == '1',
          onchange: "toggleDarkThemeFields(this.checked)" %>
      <em>When enabled, dark theme colors will be automatically generated based on light theme colors</em>
    </p>

    <h4>Light Theme Colors</h4>
    <% light_colors = s['theme_colors_light'] || {} %>
    <p class="color-wrapper">
      <label for="settings_theme_primary_light">Primary Color</label>
      <input type="color"
        name="settings[theme_colors_light][primary]"
        id="settings_theme_primary_light"
        value="<%= light_colors['primary'] || '#285236' %>">
    </p>
    <p class="color-wrapper">
      <label for="settings_theme_primary_hover_light">Primary Hover Color</label>
      <input type="color"
        name="settings[theme_colors_light][primary_hover]"
        id="settings_theme_primary_hover_light"
        value="<%= light_colors['primary_hover'] || '#2b8248' %>">
    </p>
    <p class="color-wrapper">
      <label for="settings_theme_bg_light">Background Color</label>
      <input type="color"
        name="settings[theme_colors_light][bg]"
        id="settings_theme_bg_light"
        value="<%= light_colors['bg'] || '#e5f0e9' %>">
    </p>
    <p class="color-wrapper">
      <label for="settings_theme_border_light">Border Color</label>
      <input type="color"
        name="settings[theme_colors_light][border]"
        id="settings_theme_border_light"
        value="<%= light_colors['border'] || '#acd2b9' %>">
    </p>
    <p>
      <label for="settings_theme_radius_light">Border Radius</label>
      <input type="text"
        name="settings[theme_colors_light][radius]"
        id="settings_theme_radius_light"
        value="<%= light_colors['radius'] || '8px' %>"
        placeholder="e.g., 8px, 4px, 12px">
      <em>CSS border-radius value (e.g., 8px for rounded corners, 0px for square)</em>
    </p>

    <div id="dark-theme-fields" style="<%= s['auto_generate_dark'] == '1' ? 'display:none' : '' %>">
      <h4>Dark Theme Colors</h4>
      <% dark_colors = s['theme_colors_dark'] || {} %>
      <p class="color-wrapper">
        <label for="settings_theme_primary_dark">Primary Color</label>
        <input type="color"
          name="settings[theme_colors_dark][primary]"
          id="settings_theme_primary_dark"
          value="<%= dark_colors['primary'] || '#2b8248' %>">
      </p>
      <p class="color-wrapper">
        <label for="settings_theme_primary_hover_dark">Primary Hover Color</label>
        <input type="color"
          name="settings[theme_colors_dark][primary_hover]"
          id="settings_theme_primary_hover_dark"
          value="<%= dark_colors['primary_hover'] || '#3ea05a' %>">
      </p>
      <p class="color-wrapper">
        <label for="settings_theme_bg_dark">Background Color</label>
        <input type="color"
          name="settings[theme_colors_dark][bg]"
          id="settings_theme_bg_dark"
          value="<%= dark_colors['bg'] || '#1a2920' %>">
      </p>
      <p class="color-wrapper">
        <label for="settings_theme_border_dark">Border Color</label>
        <input type="color"
          name="settings[theme_colors_dark][border]"
          id="settings_theme_border_dark"
          value="<%= dark_colors['border'] || '#4a6b52' %>">
      </p>
    </div>
  </div>
</fieldset>

<fieldset class="box collapsible collapsed">
  <legend onclick="toggleFieldset(this);" class='icon icon-collapsed'>
    <svg class="s18 icon-svg" aria-hidden="true"><use href="/assets/icons-731dc012.svg#icon--angle-right"></use></svg>
    Tracker Colors
  </legend>
  <% tracker_colors = Setting.plugin_redmine_jira_theme['tracker_colors'] || {} %>
  <div class="tabular settings">
    <% Tracker.all.order(:position).each do |tracker| %>
      <% color = tracker_colors[tracker.name.downcase].presence || "##{SecureRandom.hex(3)}" %>
      <p class="color-wrapper">
        <label for="settings_tracker_colors_<%= tracker.id %>"><%= tracker.name %></label>
        <input type="color"
          name="settings[tracker_colors][<%= tracker.name.downcase %>]"
          id="settings_tracker_colors_<%= tracker.id %>"
          value="<%= color %>">
      </p>
    <% end %>
  </div>
</fieldset>

<fieldset class="box collapsible collapsed">
  <legend onclick="toggleFieldset(this);" class='icon icon-collapsed'>
    <svg class="s18 icon-svg" aria-hidden="true"><use href="/assets/icons-731dc012.svg#icon--angle-right"></use></svg>
    Status Colors
  </legend>
  <% status_colors = Setting.plugin_redmine_jira_theme['status_colors'] || {} %>
  <div class="tabular settings">
    <% IssueStatus.all.order(:position).each do |status| %>
      <% color = status_colors[status.name.downcase].presence || "##{SecureRandom.hex(3)}" %>
      <p class="color-wrapper">
        <label for="settings_status_colors_<%= status.id %>"><%= status.name %></label>
        <input type="color"
          name="settings[status_colors][<%= status.name.downcase %>]"
          id="settings_status_colors_<%= status.id %>"
          value="<%= color %>">
      </p>
    <% end %>
  </div>
</fieldset>

<fieldset class="box collapsible collapsed">
  <legend onclick="toggleFieldset(this);" class='icon icon-collapsed'>
    <svg class="s18 icon-svg" aria-hidden="true"><use href="/assets/icons-731dc012.svg#icon--angle-right"></use></svg>
    Priority Colors
  </legend>
  <% priority_colors = Setting.plugin_redmine_jira_theme['priority_colors'] || {} %>
  <div class="tabular settings">
    <% IssuePriority.all.order(:position).each do |priority| %>
      <% color = priority_colors[priority.name.downcase].presence || "##{SecureRandom.hex(3)}" %>
      <p class="color-wrapper">
        <label for="settings_priority_colors_<%= priority.id %>"><%= priority.name %></label>
        <input type="color"
          name="settings[priority_colors][<%= priority.name.downcase %>]"
          id="settings_priority_colors_<%= priority.id %>"
          value="<%= color %>">
      </p>
    <% end %>
  </div>
</fieldset>

<fieldset class="jira-theme-plugin-setting-upload box collapsible collapsed">
  <legend onclick="toggleFieldset(this);" class='icon icon-collapsed'>
    <svg class="s18 icon-svg" aria-hidden="true"><use href="/assets/icons-731dc012.svg#icon--angle-right"></use></svg>
    Logo Settings
  </legend>
  <div class="tabular settings">
    <p>
      <label>Use same logo for dark theme</label>
      <%= check_box_tag 'settings[use_same_logo_for_dark]', '1', (s['use_same_logo_for_dark'].nil? ? true : s['use_same_logo_for_dark'] == '1'),
          onchange: "toggleDarkLogo(this.checked)" %>
      <em>When enabled, the light theme logo will be used for both themes</em>
    </p>
  </div>

  <div class="splitcontent">
    <div class="splitcontentleft section-wrp">
      <p><label>Logo</label></p>
    </div>
    <div class="splitcontentright section-wrp">
      <div class="box tabular">
        <% if s['logo_light'].present? %>
          <div class="image-upload-section">
            <%= image_tag(s['logo_light'], class: 'light', alt: 'Light Logo Preview') %>
            <div>
              <%= link_to 'Remove', '#',
                  onclick: "if(confirm('Remove light logo?')) {
                    document.getElementById('remove_logo_light').value = '1';
                    this.parentElement.parentElement.style.display = 'none';
                  } return false;",
                  class:'remove'%>
            </div>
          </div>
        <% end %>
        <%= file_field_tag 'logo_light', accept: 'image/*' %>
        <%= hidden_field_tag 'settings[remove_logo_light]', '0', id: 'remove_logo_light' %>
        <div class="jira-recommend-section">
          Recommended: PNG format, max 200x50px for best results
        </div>
      </div>
    </div>
  </div>
  <div id="dark-logo-section" class="splitcontent" style="display: none;">
    <div class="splitcontentleft section-wrp">
      <p>
        <label>Dark Theme Logo</label>
      </p>
    </div>
    <div class="splitcontentright section-wrp">
      <div class="box tabular">
        <% if s['logo_dark'].present? %>
          <div class="image-upload-section dark">
            <%= image_tag(s['logo_dark'], class: 'dark', alt: 'Dark Logo Preview') %>
            <div>
              <%= link_to 'Remove', '#',
                  onclick: "if(confirm('Remove dark logo?')) {
                    document.getElementById('remove_logo_dark').value = '1';
                    this.parentElement.parentElement.style.display = 'none';
                  } return false;",
                  class:'remove' %>
            </div>
          </div>
        <% end %>
        <%= file_field_tag 'logo_dark', accept: 'image/*' %>
        <%= hidden_field_tag 'settings[remove_logo_dark]', '0', id: 'remove_logo_dark' %>
        <div class="jira-recommend-section">
          Recommended: PNG format, max 200x50px for best results
        </div>
      </div>
    </div>
  </div>

  <div class="jira-note-section ">
    <strong>Note:</strong> If custom logos are not uploaded, the plugin will use the default logo-white.png and logo-black.png from the plugin assets.
  </div>
</fieldset>

<fieldset class="jira-theme-plugin-setting-upload box collapsible collapsed">
  <legend onclick="toggleFieldset(this);" class='icon icon-collapsed'>
    <svg class="s18 icon-svg" aria-hidden="true"><use href="/assets/icons-731dc012.svg#icon--angle-right"></use></svg>
    Favicon Settings
  </legend>
  <div class="tabular settings">
    <div class="splitcontent">
      <div class="splitcontentleft section-wrp">
        <p><label>Custom Favicon</label></p>
      </div>
      <div class="splitcontentright section-wrp">
        <div class="box tabular">
          <% if s['favicon'].present? %>
            <div class="image-upload-section">
              <img src="<%= s['favicon'] %>" alt="Current Favicon" class="favicon-preview" width="32" height="32">
              <div>
                <%= link_to 'Remove', '#',
                    onclick: "if(confirm('Remove custom favicon?')) {
                      document.getElementById('remove_favicon').value = '1';
                      this.parentElement.parentElement.style.display = 'none';
                    } return false;",
                    class:'remove'%>
              </div>
            </div>
          <% end %>
          <%= file_field_tag 'favicon', accept: 'image/x-icon,image/vnd.microsoft.icon,image/png,image/svg+xml' %>
          <%= hidden_field_tag 'settings[remove_favicon]', '0', id: 'remove_favicon' %>
          <div class="jira-recommend-section">
            Recommended: ICO format, 16x16 or 32x32 pixels. PNG and SVG also supported.
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="jira-note-section">
    <strong>Note:</strong> Custom favicon will replace the default Redmine favicon. Leave empty to use default.
  </div>
</fieldset>

<%= javascript_include_tag 'jira_settings', plugin: 'redmine_jira_theme' %>